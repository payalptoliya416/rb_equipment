# Deployment Guide for Static Export with API Routes

## Problem
Next.js static export (`output: export`) doesn't support API routes. The Sumsub API routes need to be deployed separately.

## Solution
1. **Static Frontend**: Deploy the `out` folder (generated by `npm run build`)
2. **API Server**: Deploy the separate API server from `api-server/` folder

## Steps

### 1. Build Static Frontend
```bash
npm run build
```
This will create the `out` folder with your static site.

### 2. Deploy Static Frontend
Upload the `out` folder to your static hosting:
- Netlify
- Vercel (static)
- AWS S3 + CloudFront
- Any static hosting service

### 3. Deploy API Server Separately

#### Option A: Deploy as Express Server
```bash
cd api-server
npm install
# Set environment variables
export SUMSUB_APP_TOKEN=your_token
export SUMSUB_SECRET_KEY=your_key
export SUMSUB_BASE_URL=https://api.sumsub.com
export FRONTEND_URL=https://your-frontend-domain.com
npm start
```

#### Option B: Deploy as Serverless Function
- Vercel Serverless Functions
- AWS Lambda
- Google Cloud Functions
- Azure Functions

### 4. Configure Frontend Environment Variable

Set `NEXT_PUBLIC_API_URL` to point to your deployed API server:

```env
NEXT_PUBLIC_API_URL=https://your-api-server.com
```

### 5. Update Client Code
The client code has been updated to use `NEXT_PUBLIC_API_URL` environment variable. If not set, it will fallback to `/api/sumsub/...` (which won't work in static export).

## Environment Variables

### Frontend (.env.local)
```
NEXT_PUBLIC_API_URL=https://your-api-server-url.com
```

### API Server
```
SUMSUB_APP_TOKEN=your_app_token
SUMSUB_SECRET_KEY=your_secret_key
SUMSUB_BASE_URL=https://api.sumsub.com
FRONTEND_URL=https://your-frontend-domain.com
PORT=3001
```

## Testing Locally

1. Start API server:
```bash
cd api-server
npm install
npm start
```

2. Set frontend env:
```bash
NEXT_PUBLIC_API_URL=http://localhost:3001
```

3. Build and test frontend:
```bash
npm run build
npm run start
```

## Notes

- The API routes in `app/api/` are kept for reference but won't work with static export
- The separate API server (`api-server/server.js`) should be deployed separately
- Make sure CORS is configured correctly in the API server for your frontend domain

